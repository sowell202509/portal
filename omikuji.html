<!DOCTYPE html>
<html lang="ja">
<head>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-SXB69DFE11"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-SXB69DFE11');
  </script>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>æ¯’èˆŒé¤Šç”ŸãŠã¿ãã˜ï½œã»ãã—ã‚„ ãã </title>
  <meta name="description" content="1æ—¥3å›é™å®šã€‚ã‚ãªãŸã®ä¸æ‘‚ç”Ÿã‚’æ¼¢æ–¹è¦–ç‚¹ã§æ–¬ã‚‹ã€æ¯’èˆŒãŠã¿ãã˜ã€‚"/>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ["Noto Sans JP","sans-serif"], serif: ["Shippori Mincho","serif"] },
          colors: {
            'brand-black':'#2B2725',
            'brand-brown':'#5A463B',
            'brand-gold':'#E2B46D',
            'brand-ivory':'#FBF9F6'
          },
          animation: {
             'shake': 'shake 0.5s cubic-bezier(.36,.07,.19,.97) both',
             'fade-in-up': 'fadeInUp 0.6s ease-out forwards',
             'stamp': 'stamp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards'
          },
          keyframes: {
            shake: {
              '10%, 90%': { transform: 'translate3d(-1px, 0, 0)' },
              '20%, 80%': { transform: 'translate3d(2px, 0, 0)' },
              '30%, 50%, 70%': { transform: 'translate3d(-4px, 0, 0)' },
              '40%, 60%': { transform: 'translate3d(4px, 0, 0)' }
            },
            fadeInUp: {
              '0%': { opacity: '0', transform: 'translateY(20px)' },
              '100%': { opacity: '1', transform: 'translateY(0)' },
            },
            stamp: {
              '0%': { opacity: '0', transform: 'scale(1.5)' },
              '100%': { opacity: '1', transform: 'scale(1)' },
            }
          }
        }
      }
    }
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&family=Shippori+Mincho:wght@700&display=swap" rel="stylesheet">
</head>
<body class="bg-brand-black text-white min-h-screen flex flex-col font-sans">

  <header class="p-4 flex justify-between items-center bg-brand-brown/20 border-b border-brand-gold/20">
      <a href="index.html" class="text-brand-gold font-serif font-bold hover:text-white transition">â† Topã¸æˆ»ã‚‹</a>
      <span class="text-xs text-white/50">æœ¬æ—¥ã‚ã¨ <span id="remain-count" class="text-brand-gold font-bold text-lg">3</span> å›</span>
  </header>

  <main class="flex-grow flex flex-col items-center justify-center p-4 relative overflow-hidden">
    <div class="absolute inset-0 opacity-10 pointer-events-none" 
         style="background-image: radial-gradient(#E2B46D 2px, transparent 2px); background-size: 24px 24px;"></div>

    <div id="start-screen" class="text-center z-10 max-w-md w-full animate-fade-in-up">
        <h1 class="text-3xl md:text-4xl font-serif font-bold text-brand-gold mb-3 text-shadow-md">
            æ¯’èˆŒé¤Šç”ŸãŠã¿ãã˜
        </h1>
        <p class="text-white/70 mb-10 text-sm tracking-widest">
            ä¸èª¿ã®æœ¬è³ªã€æš´ãã¾ã™ã€‚
        </p>
        
        <div class="mb-10 relative mx-auto w-40 h-64 bg-brand-brown border-4 border-brand-gold rounded-t-3xl rounded-b-lg flex items-center justify-center shadow-2xl cursor-pointer hover:scale-105 transition duration-300" onclick="playOmikuji()">
            <span class="text-5xl font-serif text-brand-gold opacity-50 select-none font-bold tracking-widest" style="writing-mode: vertical-rl; text-orientation: upright;">
                å¾¡ç¥ç±¤
            </span>
            <div class="absolute -top-2 w-44 h-5 bg-gradient-to-r from-brand-gold to-yellow-200 rounded-full shadow-md"></div>
        </div>

        <button onclick="playOmikuji()" class="w-full max-w-xs mx-auto bg-brand-gold text-brand-black font-bold py-4 rounded-full shadow-[0_0_15px_rgba(226,180,109,0.5)] text-lg hover:bg-white transition animate-pulse tracking-widest">
            é‹å‘½ã‚’å¼•ã
        </button>
    </div>

    <div id="result-screen" class="hidden z-10 w-full max-w-sm my-4">
        
        <div class="bg-brand-ivory text-brand-black rounded-sm shadow-2xl overflow-hidden animate-fade-in-up relative">
            <div class="h-2 bg-red-700 w-full"></div>
            
            <div class="p-6 md:p-8 flex flex-col items-center text-center">
                <h2 id="result-type" class="text-2xl font-serif font-bold text-brand-brown mb-4 tracking-widest border-b-2 border-brand-gold/50 pb-2 w-full"></h2>

                <div class="w-48 h-48 mb-6 relative">
                     <img id="result-img" src="" class="w-full h-full object-contain drop-shadow-md animate-stamp" alt="çµæœç”»åƒ">
                </div>

                <div class="w-full space-y-4 font-serif">
                    <div class="bg-white/60 p-3 rounded border border-brand-brown/10">
                        <p class="text-xs text-brand-brown font-bold mb-1 tracking-wider">ã€ ç—‡ çŠ¶ ã€‘</p>
                        <p id="result-msg" class="text-base font-bold leading-relaxed"></p>
                    </div>
                    <div class="bg-white/60 p-3 rounded border border-brand-brown/10">
                        <p class="text-xs text-brand-brown font-bold mb-1 tracking-wider">ã€ å¿  å‘Š ã€‘</p>
                        <p id="result-advice" class="text-sm leading-7 text-justify break-all"></p>
                    </div>
                    <div class="bg-brand-gold/20 p-3 rounded border border-brand-gold">
                        <p class="text-xs text-brand-brown font-bold mb-1 tracking-wider">ã€ ãƒ©ãƒƒã‚­ãƒ¼é¤Šç”Ÿ ã€‘</p>
                        <p id="result-lucky" class="text-lg font-bold text-brand-brown tracking-widest"></p>
                    </div>
                </div>
            </div>
            <div class="h-2 bg-red-700 w-full"></div>
        </div>

        <div class="mt-6 flex flex-col gap-3 px-4 pb-8">
            <a id="btn-book" href="salon.html" class="w-full text-white font-bold py-3.5 rounded-lg shadow-lg transition block text-center transform active:scale-95 bg-brand-brown">
                äºˆç´„ç”»é¢ã¸é€²ã‚€
            </a>

            <a id="btn-share" href="#" target="_blank" class="w-full bg-black border border-white/30 text-white font-bold py-3 rounded-full flex items-center justify-center gap-2 hover:bg-gray-900 transition mt-2">
                <span>Threadsã§æ™’ã™</span>
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M12 24c6.627 0 12-5.373 12-12S18.627 0 12 0 0 5.373 0 12s5.373 12 12 12zm0-22c5.514 0 10 4.486 10 10s-4.486 10-10 10S2 17.514 2 12 6.486 2 12 2z"/></svg>
            </a>
            
            <button onclick="resetGame()" class="text-brand-gold text-sm underline hover:text-white py-2 tracking-wider mt-1">
                ã‚‚ã†ä¸€åº¦å¼•ãï¼ˆæ®‹ã‚Š<span id="retry-count">0</span>å›ï¼‰
            </button>
        </div>
    </div>

    <div id="limit-screen" class="hidden text-center z-10 max-w-md w-full animate-fade-in-up">
        <h2 class="text-6xl mb-4">ğŸ›‘</h2>
        <h3 class="text-2xl font-serif font-bold text-brand-gold mb-4">æœ¬æ—¥ã¯æ‰“ã¡æ­¢ã‚ã€‚</h3>
        <p class="text-white/80 mb-8 leading-relaxed text-sm">
            ä¾å­˜ã¯æ–°ãŸãªä¸èª¿ã‚’ç”Ÿã¿ã¾ã™ã€‚<br>
            ç¶šãã¯æ˜æ—¥ã€ã¾ãŸã¯ã‚µãƒ­ãƒ³ã§ã€‚
        </p>
        <a href="salon.html" class="w-full bg-brand-gold text-brand-brown font-bold py-4 rounded-full shadow-lg text-lg block hover:bg-white transition">
            æœ¨ç”°ã«ç›´æ¥è¨ºã›ã‚‹
        </a>
        <a href="index.html" class="block mt-8 text-white/50 text-sm hover:text-white">ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã¸æˆ»ã‚‹</a>
    </div>

  </main>

  <script>
    // â–¼â–¼â–¼ ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹é…æ…®æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ â–¼â–¼â–¼
    const fortunes = [
      { 
        type: "ã€å»ƒè»Šå¯¸å‰ã€‘", 
        image: "./img/rank_scrap.png", 
        msg: "å…¨èº«ã‚µãƒ“ã ã‚‰ã‘ã§ã™", 
        advice: "ã‚ãªãŸã®èƒŒä¸­ã¯éŒ†ã³ã¤ã„ãŸé‰„æ¿ã§ã™ã‹ï¼Ÿã‚ªã‚¤ãƒ«ï¼ˆè¡€æµï¼‰ãŒå®Œå…¨ã«åˆ‡ã‚Œã¦ã„ã¾ã™ã€‚ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã—ãªã„ã¨äºŒåº¦ã¨å‹•ã‹ãªããªã‚Šã¾ã™ã€‚",
        lucky: "æ·±å‘¼å¸ãƒ»äºˆç´„",
        btnText: "ğŸš‘ ç·Šæ€¥ãƒ”ãƒƒãƒˆã‚¤ãƒ³ï¼ˆç©ºãç¢ºèªï¼‰",
        btnColor: "bg-red-600 hover:bg-red-500 animate-pulse"
      },
      { 
        type: "ã€å†·å‡ãƒã‚°ãƒ­ã€‘", 
        image: "./img/rank_frozen.png", 
        msg: "è§£å‡å¾…ã¡ã®çŠ¶æ…‹ã§ã™", 
        advice: "æ‰‹è¶³ã®æ¸©åº¦ãŒç”Ÿå‘½ä½“ã¨ã—ã¦ä½ã™ãã¾ã™ã€‚å¸‚å ´ã«å‡ºè·ã•ã‚Œã‚‹ç›´å‰ã§ã™ã‹ï¼Ÿ ä»Šæ—¥ã¯ç™½æ¹¯ã‚’é£²ã‚“ã§ã€æ¹¯èˆ¹ã‹ã‚‰15åˆ†ã¯å‡ºãªã„ã“ã¨ã€‚",
        lucky: "ç™½æ¹¯ãƒ»åšç€",
        btnText: "ğŸ”¥ è§£å‡ã‚³ãƒ¼ã‚¹ã‚’äºˆç´„ã™ã‚‹",
        btnColor: "bg-blue-600 hover:bg-blue-500"
      },
      { 
        type: "ã€ã‚¹ãƒãƒ›å¥´éš·ã€‘", 
        image: "./img/rank_zombie.png", 
        msg: "é¦–ã®éª¨ãŒæ³£ã„ã¦ã„ã¾ã™", 
        advice: "ç”»é¢ã«æ”¯é…ã•ã‚Œã¦ã„ã¾ã™ã­ã€‚é¦–ãŒå‰ã«è½ã¡ã¦ã‚¾ãƒ³ãƒ“ã®ã‚ˆã†ãªå§¿å‹¢ã§ã™ã€‚ä»Šã™ãã‚¹ãƒãƒ›ã‚’ç½®ã„ã¦é ãã®å±±ã‚’è¦‹ãªã•ã„ã€‚",
        lucky: "ãƒ‡ã‚¸ã‚¿ãƒ«æ–­é£Ÿ",
        btnText: "ğŸ‘€ é¦–ãƒ»ç›®ã®ç–²ã‚Œã‚’ãƒªã‚»ãƒƒãƒˆäºˆç´„",
        btnColor: "bg-purple-700 hover:bg-purple-600"
      },
      { 
        type: "ã€ã‚¬ã‚¹æ¬ ã€‘", 
        image: "./img/rank_gas.png", 
        msg: "é­‚ãŒæŠœã‘ã¦ã„ã¾ã™", 
        advice: "ç„¡ç†ã—ã¦èµ°ã‚ã†ã¨ã—ã¦ã„ã¾ã™ãŒç‡ƒæ–™ã‚¿ãƒ³ã‚¯ã¯ç©ºã£ã½ã§ã™ã€‚ã“ã‚Œä»¥ä¸Šé€²ã‚€ã¨ã‚¨ãƒ³ã‚¹ãƒˆã—ã¾ã™ã€‚ä»Šæ—¥ã¯ã€Œä½•ã‚‚ã—ãªã„ã€ã‚’ã—ãªã•ã„ã€‚",
        lucky: "æ—©å¯ãƒ»æ”¾ç½®",
        btnText: "â›½ ã‚¨ãƒãƒ«ã‚®ãƒ¼å……å¡«ã‚’äºˆç´„ã™ã‚‹",
        btnColor: "bg-yellow-600 hover:bg-yellow-500"
      },
      { 
        type: "ã€ãƒ‘ãƒ³ç”Ÿåœ°ã€‘", 
        image: "./img/rank_bread.png", 
        msg: "ç™ºé…µã—ã™ãã§ã™", 
        advice: "æ°´åˆ†ä»£è¬ãŒæ‚ªã™ãã¦ã€æŠ¼ã™ã¨æˆ»ã£ã¦ãã¾ã›ã‚“ã€‚æ¹¿æ°—ã‚’æºœã‚è¾¼ã¿ã™ãã§ã™ã€‚é™¤æ¹¿æ©Ÿï¼ˆãƒ—ãƒ­ã®æ‰‹ï¼‰ãŒå¿…è¦ã§ã™ã€‚",
        lucky: "å°è±†èŒ¶ãƒ»é‹å‹•",
        btnText: "ğŸ’§ æ°´æŠœãï¼ˆã‚€ãã¿ã‚±ã‚¢ï¼‰ã‚’äºˆç´„",
        btnColor: "bg-orange-600 hover:bg-orange-500"
      },
      { 
        type: "ã€é¤Šç”Ÿå‰ã€‘", 
        image: "./img/rank_lucky.png", 
        msg: "å¥‡è·¡ã®ãƒãƒ©ãƒ³ã‚¹ã§ã™", 
        advice: "æ‚”ã—ã„ã§ã™ãŒä»Šã¯èª¿å­ãŒè‰¯ã„ã‚ˆã†ã§ã™ã€‚ã§ã™ãŒæ²¹æ–­å¤§æ•µã€‚èª¿å­ã«ä¹—ã£ã¦å¤œãµã‹ã—ã™ã‚Œã°ã€æ˜æ—¥ã¯ä¸€è»¢ã—ã¦ã€Œå»ƒè»Šã€ç¢ºå®šã§ã™ã€‚",
        lucky: "ç‘æƒ³ãƒ»ç¶­æŒ",
        btnText: "ğŸ—“ï¸ æ¥æœˆã®ã”è¤’ç¾ãƒ¡ãƒ³ãƒ†ã‚’ç¢ºä¿",
        btnColor: "bg-green-600 hover:bg-green-500"
      }
    ];

    // â–¼â–¼â–¼ æœ¬ç•ªè¨­å®šï¼š1æ—¥3å›ã¾ã§ â–¼â–¼â–¼
    const MAX_TRIES = 3;

    document.addEventListener('DOMContentLoaded', () => {
        checkLimitDisplay();
    });

    function getStatus() {
        const today = new Date().toLocaleDateString();
        const data = JSON.parse(localStorage.getItem('kidaOmikuji')) || { date: today, count: 0 };
        if (data.date !== today) {
            return { date: today, count: 0 };
        }
        return data;
    }

    function checkLimitDisplay() {
        const status = getStatus();
        const remain = MAX_TRIES - status.count;
        
        document.getElementById('remain-count').innerText = Math.max(0, remain);
        document.getElementById('retry-count').innerText = Math.max(0, remain);

        if (remain <= 0) {
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.add('hidden');
            document.getElementById('limit-screen').classList.remove('hidden');
            return false;
        }
        return true;
    }

    function playOmikuji() {
        if (!checkLimitDisplay()) return;

        const status = getStatus();
        status.count++;
        localStorage.setItem('kidaOmikuji', JSON.stringify(status));
        
        const container = document.getElementById('start-screen');
        container.classList.add('animate-shake');
        
        setTimeout(() => {
            container.classList.remove('animate-shake');
            showResult();
        }, 800);
    }

    function showResult() {
        const result = fortunes[Math.floor(Math.random() * fortunes.length)];
        
        document.getElementById('start-screen').classList.add('hidden');
        const resultScreen = document.getElementById('result-screen');
        resultScreen.classList.remove('hidden');
        
        document.getElementById('result-type').innerText = result.type;
        document.getElementById('result-img').src = result.image;
        document.getElementById('result-msg').innerText = result.msg;
        document.getElementById('result-advice').innerText = result.advice;
        document.getElementById('result-lucky').innerText = "âœ¨ " + result.lucky + " âœ¨";

        const bookBtn = document.getElementById('btn-book');
        bookBtn.innerText = result.btnText;
        bookBtn.className = `w-full text-white font-bold py-3.5 rounded-lg shadow-lg transition block text-center transform active:scale-95 ${result.btnColor}`;

        checkLimitDisplay();

        const shareText = `ã€æœ¬æ—¥ã®æ¯’èˆŒè¨ºæ–­ã€‘\nçµæœï¼š${result.type}\nç—‡çŠ¶ï¼š${result.msg}\n\nãƒ©ãƒƒã‚­ãƒ¼é¤Šç”Ÿï¼š${result.lucky}\n\næ¼¢æ–¹è¦–ç‚¹ã§æ–¬ã‚‰ã‚Œã¾ã—ãŸã€‚æ®‹ã‚Šå›æ•°ã‚ã¨ã‚ãšã‹ã€‚\nğŸ‘‡å¼•ã„ã¦ã¿ã‚‹\nhttps://hogushiyakida.com/omikuji.html\n#ã»ãã—ã‚„ãã  #ã‚‚ã¿å¾³ #ãƒ‰Sé¤Šç”Ÿ`;
        const shareUrl = "https://www.threads.net/intent/post?text=" + encodeURIComponent(shareText);
        document.getElementById('btn-share').href = shareUrl;
    }

    function resetGame() {
        document.getElementById('result-screen').classList.add('hidden');
        if (checkLimitDisplay()) {
            document.getElementById('start-screen').classList.remove('hidden');
        }
    }
  </script>
</body>
</html>